NetUSB - .msi пакет
===================

Данный проект - .msi пакет для развёртывания в рамках домена
[клиентской части приложений NetUSB от VSCom (для NetUSB-400i)][NetUSB].

Инструменты для сборки .msi пакета
----------------------------------

Для внесения изменений в пакет и повторной сборки пакета потребуются следующие продукты:

- Microsoft Visual Studio 2012 Shell:
	- [MS Visual Studio 2012 Shell Isolated][]
	- [MS Visual Studio 2012 Shell Integrated][]
- [Windows Installer XML Toolset - WIX][WIX]

Установить необходимо все пакеты в указанном порядке. В результате - получае MS Visual Studio 2012 с подготовленными
шаблонами проектов WiX. После этого открываем файл решения `.sln` и собираем решение.

Варианты пакетов
----------------

### Административная точка установки

В папке `bin\Admin image\x86\ru-RU` собран проект, подготовленный к роли административной точки установки.
В нём отсутствует интерфейс пользователя.

### .msi пакет в виде единого файла

В папке `bin\Single .msi file\x86\ru-RU` собран .msi пакет в виде единого файла.
В отличии от предыдущего варианта, в данной редакции присутствует интерфейс пользователя,
позволяющий изменить и состав продукта, и папку его установки.

При необходимости создания административной точки установки с интерфейсом пользователя следует воспользоваться
командной строкой по следующему примеру:

    msiexec -a "bin\Single .msi file\x86\ru-RU\NetUSBclient.msi" TARGETDIR="adm\x86"

Подготовка административной точки установки
-------------------------------------------

При подготовке административной точки установки доступны к изменении нижеописанные свойства.

### Административные свойства пакета

#### DISABLESHORTCUTS

По умолчанию - `"No"`. При установке значения `"Yes"` при установке не будут опубликованы ярлыки.
Данным свойством следует воспользоваться, если Вы планируете запускать приложения АИС Метроконтроль через ярлыки на
`.csmdb23` файлы (о данных дополнительных возможностях пакета читайте далее).

#### DISABLEDESKTOPSHORTCUTS

По умолчанию - `"No"`. При установке значения `"Yes"` при установке не будут опубликованы ярлыки на рабочем столе.
При `DISABLESHORTCUTS="Yes"` значение данного свойства роли не играет.

#### DISABLEMENUSHORTCUTS

По умолчанию - `"No"`. При установке значения `"Yes"` при установке не будут опубликованы ярлыки в меню.
При `DISABLESHORTCUTS="Yes"` значение данного свойства роли не играет.

#### DISABLESTARTUPSHORTCUTS

По умолчанию - `"Yes"`. При установке значения `"Yes"` при установке не будут опубликованы ярлык на АИС Метроконтроль
в меню автозагрузки. При `DISABLESHORTCUTS="Yes"` значение данного свойства роли не играет.

#### APPLICATIONFOLDER

Путь к папке, в которую будет установлен программный продукт.
Устанавливать в качестве значения данного свойства требуется только путь по отношению к `%ProgramFiles%`.

#### DEFAULT_AUTOCONECT_VALUE

Заранее прошу, не ругайте за ошибки в написании свойств (я знаю, что connect с двумя n пишется). 
Здесь и далее наименование свойств в точности соответствует наименованию полей в `NUPortCustom.ini` файле.

По умолчанию - `1`, что означает, что при загрузке ПК (если установлено приложение как служба)
выбранные ранее удалённые USB устройства будут подключены автоматически. `0` будет означать,
что автоматического подключения раннее подключенных устройств при загрузке приложения /
службы не будет производиться.

#### DEFAULT_AUTORECONECT_VALUE

По умолчанию - `1`, что означает, что при временной потере подключения
выбранные ранее удалённые USB устройства будут подключены переподключаться автоматически.
`0` отключает данную возможность.

#### AUTOLAUNCH_DELAY

В милисекундах, по умолчанию - `1000` (1 секунда). Задаёт величину задержки с момента подключения
устройства до запуска приложения, ассоциированного с ним (если таковое указано при настройке
подключения к устройству).

#### DEFAULT_UNLOAD_WAITTIME

В милисекундах, по умолчанию - `5000` (5 секунд). Задаёт величину периода ожидания ответа от 
USB сервера до момент признания факта его недоступности в сети.

По истечении указанного времени подключенные с неответившего USB сервера устройства будут
отключены.

#### DEFAULT_START_AUTOLAUNCH

По умолчанию - `0`, что означает, приложение автоматически не будет запускаться при входе
пользователя. `1` - загружать приложение автоматически при входе пользователя.
Данный флаг не влияет на работоспособность службы.

#### DEFAULT_SHOW_WIN_MINIMIZED

По умолчанию - `1`, что означает, что окно запущенного автоматически приложения (см.
[DEFAULT_START_AUTOLAUNCH](#DEFAULT_START_AUTOLAUNCH)) будет свёрнуто.
`0` - окно будет развёрнуто.

#### DEFAULT_BOOTSTART

По умолчанию - `1`, что означает, что будет установлена служба `UsbIpService`, обеспечивающая
подключение удалённых USB устройств без регистрации пользователя автоматически после загрузки
операционной системы. 

Данный флаг в отличии от оригинального дистрибутива в данном пакете так же используется для
создания указанной службы в процессе установки. 

`0` - Служба установлена не будет.

#### DEFAULT_START_DEV_MAP

По умолчанию - `1`. Определяет, запускать ли автоматически сопоставление удалённых USB устройств
при обнаружении USB сервера или нет. `0` - не запускать.

#### CONFIGINTF_PORT

По умолчанию - `1341`. Номер UDP порта, используемый Server Manager.

Данный порт открывается на серверах USB, и используется для управления этими серверами из
Server Manager и QuickConfigUtility.

#### UDPSERVER_PORT

По умолчанию - `1341` (см.[CONFIGINTF_PORT](#CONFIGINTF_PORT)).
Номер UDP порта, используемый QuickConfigUtility.

Данный порт открывается на серверах USB, и используется для управления этими серверами из
Server Manager и QuickConfigUtility.

#### DEFAULT_BROADCAST_PORTNO

По умолчанию - `6000`. Номер **входящего UDP порта** (`netstat -oan` позволил выяснить
данный факт), на который Server Manager принимает широковещательные пакеты от серверов USB
(с целью их обнаружения). Используется только на приём.

#### USBIP_TCPPORTNO

По умолчанию - `3240`. Номер **TCP порта**, по которому взаимодействуют драйвер и сервер USB.
Этот порт открывается на USB сервере, а клиент использует
динамический TCP порт для **исходящего подключения**.
Подтверждено `netstat -oan`:

    TCP    192.168.100.4:58385    192.168.100.30:3240    ESTABLISHED     4

#### DEVICE_REQUEST_PORTNO

По умолчанию - `6133`. **Входящий TCP порт**, откываемый на клиенте приложением Server Manager.
На данном порту клиент ожидает запросов на освобождение занятых устройств от других клиентов.
Подтверждено `netstat -oan`:

    TCP    0.0.0.0:6133           0.0.0.0:0              LISTENING       2012

P.S. Порт открывается только после подключения как минимум одного устройства.

#### DEFAULT_GENERAL_NETWORK_THROTTLE

По умолчанию - `0`. Пока суть данной опции не понял. Поддерживается только на Windows 7 и старше.

### Примеры

Несколько примеров подготовки административной точки установки:

	msiexec -a NetUSBclient.msi DISABLEDESKTOPSHORTCUTS=Yes

Данная командная строка готовит точку установки с "отключенными" ярлыками рабочего стола.

	msiexec -a NetUSBclient.msi DISABLESHORTCUTS=Yes

Данная командная строка готовит точку установки с "отключенными" ярлыками.

[NetUSB]: http://www.vscom.de/413.htm
[MS Visual Studio 2012 Shell Isolated]: http://www.microsoft.com/ru-ru/download/details.aspx?id=30670
[MS Visual Studio 2012 Shell Integrated]: http://www.microsoft.com/ru-ru/download/details.aspx?id=30663
[WIX]: http://wixtoolset.org/
